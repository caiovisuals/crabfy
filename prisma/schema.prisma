generator client {
    provider = "prisma-client"
    output   = "./src/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

model Session {
    id           String   @id @default(uuid())
    userId       String
    token        String   @unique
    expiresAt    DateTime

    user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    createdAt    DateTime @default(now())
}

model User {
    id            String   @id @default(uuid())
    name          String
    username      String   @unique
    email         String   @unique
    password      String
    bio           String?
    avatarUrl     String?
    role          Role     @default(USER)

    xp            Int      @default(0)
    level         Int      @default(1)

    visibility    Visibility @default(PUBLIC)

    sessions      Session[]

    following     Follow[] @relation("following")
    followers     Follow[] @relation("followers")

    createdAt     DateTime @default(now())
    updatedAt     DateTime @updatedAt
}

model Follow {
    id           String   @id @default(uuid())

    followerId   String
    followingId  String

    follower     User @relation("following", fields: [followerId], references: [id], onDelete: Cascade)
    following    User @relation("followers", fields: [followingId], references: [id], onDelete: Cascade)

    createdAt    DateTime @default(now())

    @@unique([followerId, followingId])
}

enum Role {
    USER
    ADMIN
}

enum Visibility {
    PUBLIC
    PRIVATE
}
